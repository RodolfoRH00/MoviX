<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">

    <head>
        <title layout:title-content="Populares">Películas Populares</title>
        <style>
            .card-img-overlay.overlay {
                background: linear-gradient(to top, rgba(18,18,18,0.9) 40%, transparent);
            }
        </style>
    </head>

    <body>
        <section layout:fragment="content">
            <div class="container py-4">
                <h1 class="mb-4">Películas Populares</h1>
                <div class="row row-cols-2 row-cols-md-4 g-4">
                    <div th:each="pelicula : ${pelis}" class="col">
                        <div class="card bg-dark text-white h-100 border-0">
                            <img th:src="@{'https://image.tmdb.org/t/p/w500' + ${pelicula.posterPath}}"
                                 th:alt="${pelicula.title}" class="card-img-top"
                                 style="object-fit:cover; height:330px;" />
                            <div class="card-img-overlay overlay d-flex flex-column justify-content-end p-2">
                                <h5 class="card-title" th:text="${pelicula.title}">Título</h5>
                                <p class="card-text small"
                                   th:text="${pelicula.overview}"
                                   style="max-height:3em; overflow:hidden; text-overflow:ellipsis; line-height:1.2;">Descripción</p>
                                <div class="mt-2">
                                    <!-- Si ya está en favoritos, mostrar botón Quitar -->
                                    <div th:if="${favoriteIds.contains(pelicula.id)}" style="display:inline;">
                                        <form th:action="@{/favorite}" method="post" style="display:inline;">
                                            <input type="hidden" name="mediaId" th:value="${pelicula.id}" />
                                            <input type="hidden" name="favorite" value="false" />
                                            <button type="submit" class="btn btn-sm btn-danger" title="Quitar de mi lista">
                                                <i class="bi bi-x-lg"></i>
                                            </button>
                                        </form>
                                    </div>
                                    <!-- Si no está, mostrar botón Agregar -->
                                    <div th:unless="${favoriteIds.contains(pelicula.id)}" style="display:inline;">
                                        <form th:action="@{/favorite}" method="post" style="display:inline;">
                                            <input type="hidden" name="mediaId" th:value="${pelicula.id}" />
                                            <input type="hidden" name="favorite" value="true" />
                                            <button type="submit" class="btn btn-sm btn-light" title="Agregar a mi lista">
                                                <i class="bi bi-plus-lg"></i>
                                            </button>
                                        </form>
                                    </div>
                                    <!-- Botón Ver detalles -->
                                    <a th:href="@{'/movie/' + ${pelicula.id}}"
                                       class="btn btn-sm btn-outline-light ms-1" title="Ver detalles">
                                        <i class="bi bi-info-circle"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </body>
</html>
