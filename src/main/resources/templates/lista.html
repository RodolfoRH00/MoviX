<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">

    <head>
        <title layout:title-content="Mi Lista">Mi Lista</title>

        <style>
            /* --------- Tarjetas --------- */
            .movie-card {
                position: relative;
                width: 240px;
                height: 360px;
                border: 0;
                border-radius: .75rem;
                overflow: hidden;
                background: #1f1f1f;
                transition: transform .25s ease, box-shadow .25s ease;
            }
            .movie-card:hover {
                transform: scale(1.05);
                box-shadow: 0 8px 20px rgba(0,0,0,.6);
                z-index: 5;
            }
            .movie-card img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

            /* Gradiente inferior + contenido */
            .movie-overlay {
                position: absolute;
                inset: 0;
                display: flex;
                flex-direction: column;
                justify-content: flex-end;
                padding: .75rem;
                background: linear-gradient(to top, rgba(18,18,18,.9) 45%, rgba(0,0,0,.15) 80%, transparent);
                opacity: 0;
                transition: opacity .25s ease;
            }
            .movie-card:hover .movie-overlay {
                opacity: 1;
            }

            .movie-title {
                font-size: 1rem;
                font-weight: 600;
                margin-bottom: .25rem;
            }

            .movie-overview {
                font-size: .85rem;
                color: #d0d0d0;
                display: -webkit-box;
                -webkit-line-clamp: 2;          /* máximo 2 líneas */
                -webkit-box-orient: vertical;
                overflow: hidden;
            }

            /* --------- Badges y botones flotantes --------- */
            .rating-badge {
                position: absolute;
                top: .5rem;
                left: .5rem;
                background: rgba(0,0,0,.75);
                backdrop-filter: blur(2px);
                padding: .25rem .45rem;
                border-radius: .35rem;
                font-size: .8rem;
                font-weight: 600;
            }

            .card-actions {
                margin-top: .5rem;
            }

            /* Botón quitar -> sólo visible en hover */
            .btn-remove{
                position:absolute;
                top:.4rem;
                right:.4rem;
                z-index:20;               /* ← más alto que el overlay */
                opacity:0;
                transition:opacity .25s;
            }

            .movie-card:hover .btn-remove {
                opacity: 1;
            }
        </style>
    </head>

    <body>
        <section layout:fragment="content">
            <div class="container py-4">

                <h1 class="mb-4">Mi Lista</h1>

                <!-- Vacío -->
                <div th:if="${#lists.isEmpty(favoritos)}"
                     class="alert alert-info text-center">
                    No tienes películas en tu lista.
                    <a th:href="@{/}" class="alert-link">Descubre nuevas películas</a>.
                </div>

                <!-- Lista -->
                <div th:if="${!#lists.isEmpty(favoritos)}"
                     class="d-flex flex-wrap gap-3 justify-content-start">

                    <div th:each="pelicula : ${favoritos}" class="movie-card">

                        <!-- Imagen -->
                        <img th:src="@{'https://image.tmdb.org/t/p/w500' + ${pelicula.posterPath}}"
                             th:alt="${pelicula.title}"/>

                        <!-- Valoración -->
                        <span class="rating-badge">
                            <i class="bi bi-star-fill text-warning"></i>
                            <span th:text="${#numbers.formatDecimal(pelicula.voteAverage,1,1)}">7.8</span>
                        </span>

                        <!-- Botón quitar -->
                        <form th:action="@{/favorite}" method="post" class="btn-remove">
                            <input type="hidden" name="mediaId" th:value="${pelicula.id}"/>
                            <input type="hidden" name="favorite" value="false"/>
                            <button class="btn btn-sm btn-danger"
                                    data-bs-toggle="tooltip"
                                    data-bs-title="Quitar de mi lista">
                                <i class="bi bi-x-lg"></i>
                            </button>
                        </form>

                        <!-- Overlay con info -->
                        <div class="movie-overlay">
                            <div class="movie-title" th:text="${pelicula.title}">Título</div>
                            <p class="movie-overview" th:text="${pelicula.overview}">
                                Descripción película…
                            </p>

                            <div class="card-actions">
                                <a th:href="@{'/movie/' + ${pelicula.id}}"
                                   class="btn btn-sm btn-outline-light"
                                   data-bs-toggle="tooltip"
                                   data-bs-title="Ver detalles">
                                    <i class="bi bi-info-circle"></i>
                                </a>
                            </div>
                        </div><!-- /.overlay -->

                    </div><!-- /.movie-card -->
                </div><!-- /.flex wrap -->

            </div>
        </section>

        <!-- Activa tooltips -->
        <script th:inline="javascript">
            document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(el => {
                new bootstrap.Tooltip(el);
            });
        </script>
    </body>
</html>
